# =========================================================
# Portal 客户端 OS 识别（基于 User-Agent）
#
# 设计说明：
# - 使用 nginx map 指令进行 UA → OS 的一次性映射
# - 避免在 location 中使用 if 判断（性能更优、逻辑更集中）
# - 识别结果统一写入 $portal_os，供日志、鉴权、策略分支使用
#
# 使用原则：
# - 仅识别“对 Portal 行为有差异的 OS”
# - 不追求精确版本号，避免 UA 频繁变动导致误判
#
# 当前识别策略：
# - iOS      : iPhone / iPad / CaptiveNetworkSupport
# - Windows  : Windows NT / Microsoft NCSI
# - Android  : Android
# - 其他     : unknown（走通用策略）
# =========================================================

map $http_user_agent $portal_os {
    default        "unknown";

    # ---------------- iOS / iPadOS ----------------
    ~*iPhone                 "ios";
    ~*iPad                   "ios";
    ~*CaptiveNetworkSupport  "ios";

    # ---------------- Windows ---------------------
    ~*Windows                "windows";
    ~*Microsoft\ NCSI        "windows";

    # ---------------- Android ---------------------
    ~*Android                "android";
}